<!-- app/views/layouts/application.html.erb - Enhanced with Bootstrap and responsive design -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>
      <%= content_for?(:title) ? content_for(:title) : "Northern Lights Outdoor Gear - Premium Outdoor Equipment" %>
    </title>
    
    <meta name="description" content="<%= content_for?(:meta_description) ? content_for(:meta_description) : 'Northern Lights Outdoor Gear - Premium outdoor equipment and adventure gear in Winnipeg, Manitoba.' %>">
    <meta name="robots" content="index, follow">
    <meta name="author" content="Northern Lights Outdoor Gear">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="<%= content_for?(:title) ? content_for(:title) : 'Northern Lights Outdoor Gear' %>">
    <meta property="og:description" content="Premium outdoor equipment and adventure gear">
    <meta property="og:image" content="<%= asset_url('logo.png') rescue '/icon.svg' %>">
    
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    
    <!-- Bootstrap CSS (4.1.6) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
    
    <!-- Favicon -->
    <%= favicon_link_tag "/icon.svg", type: "image/svg+xml" %>
  </head>

  <body data-bs-theme="light">
    <!-- Skip Link for Accessibility -->
    <a href="#main-content" class="visually-hidden-focusable">Skip to main content</a>
    
    <!-- Header (4.1.2 - Consistent look and feel) -->
    <header class="main-header" role="banner">
      <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
          <!-- Brand -->
          <%= link_to root_path, class: "navbar-brand d-flex align-items-center" do %>
            <i class="fas fa-mountain me-2"></i>
            <span class="d-none d-sm-inline">Northern Lights Outdoor Gear</span>
            <span class="d-sm-none">Northern Lights</span>
          <% end %>
          
          <!-- Mobile Toggle -->
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
          </button>
          
          <!-- Navigation -->
          <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav me-auto">
              <li class="nav-item">
                <%= link_to "Shop All", products_path, 
                           class: "nav-link #{'active' if current_page?(products_path)}" %>
              </li>
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                  Categories
                </a>
                <ul class="dropdown-menu">
                  <%= link_to "All Categories", categories_path, class: "dropdown-item" %>
                  <li><hr class="dropdown-divider"></li>
                  <% Category.root_categories.ordered.limit(5).each do |category| %>
                    <li>
                      <%= link_to category.name, category_path(category.slug), class: "dropdown-item" %>
                    </li>
                  <% end %>
                </ul>
              </li>
              <li class="nav-item">
                <%= link_to "About", about_path, 
                           class: "nav-link #{'active' if current_page?(about_path)}" %>
              </li>
              <li class="nav-item">
                <%= link_to "Contact", contact_path, 
                           class: "nav-link #{'active' if current_page?(contact_path)}" %>
              </li>
            </ul>
            
            <!-- Right Side Navigation -->
            <ul class="navbar-nav">
              <!-- Search Form (Mobile Hidden) -->
              <li class="nav-item d-none d-lg-block me-3">
                <%= form_with url: products_path, method: :get, local: true, class: "d-flex" do |f| %>
                  <%= f.text_field :search, 
                                   placeholder: "Search products...", 
                                   value: params[:search], 
                                   class: "form-control form-control-sm me-2",
                                   style: "min-width: 200px;" %>
                  <%= f.submit "Search", class: "btn btn-outline-light btn-sm" %>
                <% end %>
              </li>
              
              <!-- Cart Dropdown (4.1.7 - Responsive) -->
              <li class="nav-item dropdown cart-dropdown">
                <a class="nav-link dropdown-toggle position-relative" href="#" role="button" data-bs-toggle="dropdown">
                  <i class="fas fa-shopping-cart"></i>
                  <span class="d-none d-md-inline ms-1">Cart</span>
                  <% if defined?(cart_item_count) && cart_item_count > 0 %>
                    <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                      <%= cart_item_count %>
                    </span>
                  <% end %>
                </a>
                
                <!-- Cart Dropdown Menu -->
                <div class="dropdown-menu dropdown-menu-end cart-dropdown-menu" style="min-width: 320px;">
                  <% if defined?(cart_item_count) && cart_item_count > 0 %>
                    <div class="dropdown-header d-flex justify-content-between align-items-center">
                      <h6 class="mb-0">Cart Preview</h6>
                      <small class="text-muted"><%= pluralize(cart_item_count, 'item') %></small>
                    </div>
                    <div class="dropdown-divider"></div>
                    
                    <div class="px-3 py-2" style="max-height: 300px; overflow-y: auto;">
                      <% if defined?(current_cart) %>
                        <% current_cart.products.first(3).each do |cart_item| %>
                          <div class="d-flex align-items-center mb-2">
                            <% if cart_item[:product].primary_image.present? %>
                              <%= image_tag cart_item[:product].primary_image, 
                                          class: "rounded me-2", 
                                          style: "width: 40px; height: 40px; object-fit: cover;" %>
                            <% else %>
                              <div class="bg-light rounded me-2 d-flex align-items-center justify-content-center" 
                                   style="width: 40px; height: 40px;">
                                <i class="fas fa-image text-muted"></i>
                              </div>
                            <% end %>
                            
                            <div class="flex-grow-1">
                              <div class="fw-semibold small">
                                <%= truncate(cart_item[:product].name, length: 25) %>
                              </div>
                              <div class="text-muted small">
                                <%= cart_item[:quantity] %> × <%= number_to_currency(cart_item[:product].display_price) %>
                              </div>
                            </div>
                            
                            <div class="fw-bold">
                              <%= number_to_currency(cart_item[:total_price]) %>
                            </div>
                          </div>
                        <% end %>
                        
                        <% if current_cart.products.count > 3 %>
                          <div class="text-center text-muted small mt-2">
                            ... and <%= current_cart.products.count - 3 %> more items
                          </div>
                        <% end %>
                      <% end %>
                    </div>
                    
                    <div class="dropdown-divider"></div>
                    <div class="px-3 py-2">
                      <div class="d-flex justify-content-between fw-bold mb-2">
                        <span>Subtotal:</span>
                        <span><%= number_to_currency(cart_subtotal) if defined?(cart_subtotal) %></span>
                      </div>
                      <%= link_to "View Full Cart", cart_path, class: "btn btn-primary w-100 btn-sm" %>
                    </div>
                  <% else %>
                    <div class="px-3 py-4 text-center text-muted">
                      <i class="fas fa-shopping-cart fa-2x mb-2"></i>
                      <div>Your cart is empty</div>
                      <small>Add some products to get started!</small>
                    </div>
                  <% end %>
                </div>
              </li>
              
              <!-- User Menu -->
              <% if user_signed_in? %>
                <li class="nav-item dropdown">
                  <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                    <i class="fas fa-user"></i>
                    <span class="d-none d-md-inline ms-1">
                      <%= current_user.first_name || current_user.email.split('@').first %>
                    </span>
                  </a>
                  <ul class="dropdown-menu dropdown-menu-end">
                    <li><%= link_to "My Orders", orders_path, class: "dropdown-item" %></li>
                    <li><%= link_to "My Addresses", addresses_path, class: "dropdown-item" %></li>
                    <li><%= link_to "Account Settings", edit_user_registration_path, class: "dropdown-item" %></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><%= link_to "Sign Out", destroy_user_session_path, method: :delete, class: "dropdown-item" %></li>
                  </ul>
                </li>
              <% else %>
                <li class="nav-item">
                  <%= link_to "Sign In", new_user_session_path, class: "nav-link" %>
                </li>
                <li class="nav-item">
                  <%= link_to "Sign Up", new_user_registration_path, class: "nav-link" %>
                </li>
              <% end %>
              
              <!-- Admin Link -->
              <li class="nav-item">
                <%= link_to "Admin", admin_root_path, class: "nav-link text-warning" %>
              </li>
            </ul>
          </div>
        </div>
      </nav>
      
      <!-- Mobile Search Bar (4.1.7) -->
      <div class="container d-lg-none mt-3">
        <%= form_with url: products_path, method: :get, local: true, class: "d-flex" do |f| %>
          <%= f.text_field :search, 
                           placeholder: "Search products...", 
                           value: params[:search], 
                           class: "form-control me-2" %>
          <%= f.submit "Search", class: "btn btn-outline-light" %>
        <% end %>
      </div>
    </header>
    
    <!-- Main Content -->
    <main id="main-content" role="main" class="container-fluid px-0">
      <!-- Flash Messages (4.1.2) -->
      <div class="container mt-3">
        <% if notice %>
          <div class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="fas fa-check-circle me-2"></i>
            <%= notice %>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
          </div>
        <% end %>
        
        <% if alert %>
          <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class="fas fa-exclamation-triangle me-2"></i>
            <%= alert %>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
          </div>
        <% end %>
      </div>
      
      <!-- Breadcrumbs (if content_for :breadcrumbs is set) -->
      <% if content_for?(:breadcrumbs) %>
        <div class="container">
          <%= yield(:breadcrumbs) %>
        </div>
      <% end %>
      
      <!-- Page Content -->
      <div class="<%= content_for?(:full_width) ? '' : 'container' %> mb-5">
        <%= yield %>
      </div>
    </main>
    
    <!-- Footer (4.1.2) -->
    <footer class="main-footer mt-auto" role="contentinfo">
      <div class="container">
        <div class="row">
          <!-- Company Info -->
          <div class="col-md-4 mb-4">
            <h5 class="fw-bold mb-3">
              <i class="fas fa-mountain me-2"></i>
              Northern Lights Outdoor Gear
            </h5>
            <p class="mb-2">
              <i class="fas fa-map-marker-alt me-2"></i>
              123 Adventure Way, Winnipeg, MB
            </p>
            <p class="mb-2">
              <i class="fas fa-phone me-2"></i>
              (204) 555-GEAR (4327)
            </p>
            <p class="mb-3">
              <i class="fas fa-envelope me-2"></i>
              info@northernlights.com
            </p>
            
            <!-- Social Media -->
            <div class="d-flex gap-3">
              <a href="#" class="text-light fs-5"><i class="fab fa-facebook"></i></a>
              <a href="#" class="text-light fs-5"><i class="fab fa-instagram"></i></a>
              <a href="#" class="text-light fs-5"><i class="fab fa-twitter"></i></a>
              <a href="#" class="text-light fs-5"><i class="fab fa-youtube"></i></a>
            </div>
          </div>
          
          <!-- Quick Links -->
          <div class="col-md-2 mb-4">
            <h6 class="fw-bold mb-3">Shop</h6>
            <ul class="list-unstyled">
              <li class="mb-2"><%= link_to "All Products", products_path, class: "text-light text-decoration-none" %></li>
              <li class="mb-2"><%= link_to "Categories", categories_path, class: "text-light text-decoration-none" %></li>
              <li class="mb-2"><%= link_to "Featured", products_path(featured: true), class: "text-light text-decoration-none" %></li>
              <li class="mb-2"><%= link_to "On Sale", products_path(on_sale: true), class: "text-light text-decoration-none" %></li>
            </ul>
          </div>
          
          <!-- Customer Service -->
          <div class="col-md-3 mb-4">
            <h6 class="fw-bold mb-3">Customer Service</h6>
            <ul class="list-unstyled">
              <li class="mb-2"><%= link_to "Contact Us", contact_path, class: "text-light text-decoration-none" %></li>
              <li class="mb-2"><a href="#" class="text-light text-decoration-none">Shipping Info</a></li>
              <li class="mb-2"><a href="#" class="text-light text-decoration-none">Returns</a></li>
              <li class="mb-2"><a href="#" class="text-light text-decoration-none">Size Guide</a></li>
              <li class="mb-2"><a href="#" class="text-light text-decoration-none">FAQ</a></li>
            </ul>
          </div>
          
          <!-- Newsletter -->
          <div class="col-md-3 mb-4">
            <h6 class="fw-bold mb-3">Stay Updated</h6>
            <p class="small mb-3">Get the latest gear updates and outdoor tips!</p>
            <form class="d-flex">
              <input type="email" class="form-control form-control-sm me-2" placeholder="Your email">
              <button type="submit" class="btn btn-outline-light btn-sm">Subscribe</button>
            </form>
          </div>
        </div>
        
        <hr class="my-4">
        
        <!-- Copyright -->
        <div class="row align-items-center">
          <div class="col-md-8">
            <p class="mb-0 small">
              &copy; <%= Date.current.year %> Northern Lights Outdoor Gear. All rights reserved.
              <span class="mx-2">|</span>
              <a href="#" class="text-light text-decoration-none">Privacy Policy</a>
              <span class="mx-2">|</span>
              <a href="#" class="text-light text-decoration-none">Terms of Service</a>
            </p>
          </div>
          <div class="col-md-4 text-md-end">
            <small class="text-light opacity-75">
              Built with <i class="fas fa-heart text-danger"></i> in Winnipeg, MB
            </small>
          </div>
        </div>
      </div>
    </footer>
    
    <!-- Bootstrap JS (4.1.6) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Custom JavaScript -->
    <script>
      // Quick add to cart animation
      document.addEventListener('DOMContentLoaded', function() {
        const quickAddForms = document.querySelectorAll('.quick-add-form');
        
        quickAddForms.forEach(form => {
          form.addEventListener('submit', function(e) {
            const button = form.querySelector('.quick-add-btn');
            const originalText = button.value;
            
            // Add success animation after form submission
            setTimeout(() => {
              button.value = '✓ Added!';
              button.classList.add('btn-success');
              
              setTimeout(() => {
                button.value = originalText;
                button.classList.remove('btn-success');
              }, 2000);
            }, 500);
          });
        });
        
        // Auto-hide alerts after 5 seconds
        const alerts = document.querySelectorAll('.alert');
        alerts.forEach(alert => {
          setTimeout(() => {
            const bsAlert = new bootstrap.Alert(alert);
            bsAlert.close();
          }, 5000);
        });
      });
    </script>
    
    <!-- Back to Top Button (4.1.2) -->
    <button id="backToTop" class="btn btn-primary position-fixed bottom-0 end-0 m-3 rounded-circle" 
            style="width: 50px; height: 50px; z-index: 1000; display: none;">
      <i class="fas fa-arrow-up"></i>
    </button>
    
    <script>
      // Back to top functionality
      const backToTopBtn = document.getElementById('backToTop');
      
      window.addEventListener('scroll', function() {
        if (window.pageYOffset > 300) {
          backToTopBtn.style.display = 'block';
        } else {
          backToTopBtn.style.display = 'none';
        }
      });
      
      backToTopBtn.addEventListener('click', function() {
        window.scrollTo({
          top: 0,
          behavior: 'smooth'
        });
      });
    </script>
  </body>
</html>