<!-- app/views/categories/show.html.erb -->

<!-- Breadcrumb Navigation -->
<div class="breadcrumb" style="margin-bottom: 20px; padding: 10px 0; color: #7f8c8d; font-size: 14px;">
  <%= link_to "All Categories", categories_path, style: "color: #3498db; text-decoration: none;" %> 
  <% if @category.parent_category %>
    > <%= link_to @category.parent_category.name, category_path(@category.parent_category.slug), style: "color: #3498db; text-decoration: none;" %>
  <% end %>
  > <span style="color: #2c3e50; font-weight: bold;"><%= @category.name %></span>
</div>

<!-- Category Header -->
<div class="category-header" style="text-align: center; margin-bottom: 30px; padding: 30px; background-color: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
  <h1 style="color: #2c3e50; margin-bottom: 10px;"><%= @category.name %></h1>
  <% if @category.description.present? %>
    <p style="color: #7f8c8d; font-size: 16px; margin-bottom: 15px;"><%= @category.description %></p>
  <% end %>
  <div>
    <span style="background-color: #3498db; color: white; padding: 8px 15px; border-radius: 20px;">
      <%= pluralize(@total_count, 'product') %> available
    </span>
  </div>
</div>

<!-- Subcategories Navigation (if any) -->
<% if @subcategories.any? %>
  <div class="subcategories" style="margin-bottom: 30px;">
    <h3 style="text-align: center; color: #2c3e50; margin-bottom: 20px;">Browse Subcategories</h3>
    <div class="subcategories-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px;">
      <% @subcategories.each do |subcategory| %>
        <div class="subcategory-card" style="background-color: white; border-radius: 6px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); padding: 15px; text-align: center; transition: transform 0.3s;">
          <%= link_to category_path(subcategory.slug), style: "text-decoration: none; color: inherit;" do %>
            <h5 style="color: #2c3e50; margin-bottom: 5px;"><%= subcategory.name %></h5>
            <div style="color: #7f8c8d; font-size: 14px;">
              <%= pluralize(subcategory.products.count, 'product') %>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>
<% end %>

<!-- Search and Filters for this Category -->
<div class="category-filters" style="background-color: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px;">
  <!-- Search within category -->
  <div class="search-bar" style="text-align: center; margin-bottom: 15px;">
    <%= form_with url: category_path(@category.slug), method: :get, local: true do |f| %>
      <%= f.text_field :search, placeholder: "Search in #{@category.name}...", value: params[:search], style: "padding: 8px; width: 250px; border: 1px solid #ddd; border-radius: 4px; margin-right: 10px;" %>
      <%= f.submit "Search", style: "padding: 8px 15px; background-color: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer;" %>
    <% end %>
  </div>
  
  <!-- Filter options -->
  <div class="filter-bar" style="text-align: center;">
    <%= link_to "All Products", category_path(@category.slug), 
                class: "filter-link", style: "display: inline-block; margin: 5px; padding: 6px 12px; background-color: #{params[:featured].blank? && params[:on_sale].blank? ? '#3498db' : '#ecf0f1'}; color: #{params[:featured].blank? && params[:on_sale].blank? ? 'white' : '#2c3e50'}; text-decoration: none; border-radius: 15px; font-size: 14px;" %>
    <%= link_to "Featured Only", category_path(@category.slug, featured: true), 
                style: "display: inline-block; margin: 5px; padding: 6px 12px; background-color: #{params[:featured] == 'true' ? '#3498db' : '#ecf0f1'}; color: #{params[:featured] == 'true' ? 'white' : '#2c3e50'}; text-decoration: none; border-radius: 15px; font-size: 14px;" %>
    <%= link_to "On Sale", category_path(@category.slug, on_sale: true), 
                style: "display: inline-block; margin: 5px; padding: 6px 12px; background-color: #{params[:on_sale] == 'true' ? '#27ae60' : '#ecf0f1'}; color: #{params[:on_sale] == 'true' ? 'white' : '#2c3e50'}; text-decoration: none; border-radius: 15px; font-size: 14px;" %>
  </div>
</div>

<!-- Products Grid -->
<div class="products-grid">
  <% @products.each do |product| %>
    <div class="product-card">
      <%= link_to product_path(product), style: "text-decoration: none; color: inherit;" do %>
        <% if product.primary_image.present? %>
          <%= image_tag product.primary_image, alt: product.name, class: "product-image" %>
        <% else %>
          <div class="product-image" style="display: flex; align-items: center; justify-content: center; color: #7f8c8d;">
            No Image
          </div>
        <% end %>
        
        <div class="product-info">
          <div class="product-categories">
            <%= product.category_names %>
          </div>
          
          <div class="product-name">
            <%= product.name %>
          </div>
          
          <div class="product-price <%= 'on-sale' if product.on_sale? %>">
            <% if product.on_sale? %>
              <%= number_to_currency(product.sale_price) %>
              <span class="original-price"><%= number_to_currency(product.price) %></span>
            <% else %>
              <%= number_to_currency(product.price) %>
            <% end %>
          </div>
          
          <div class="product-stock <%= product.in_stock? ? 'in-stock' : 'out-of-stock' %>">
            <%= product.in_stock? ? "In Stock (#{product.stock_quantity})" : "Out of Stock" %>
          </div>
        </div>
      <% end %>
    </div>
  <% end %>
</div>

<!-- Pagination -->
<% if @total_pages > 1 %>
  <div class="pagination">
    <% if @current_page > 1 %>
      <%= link_to "Previous", category_path(@category.slug, params.permit!.merge(page: @current_page - 1)) %>
    <% end %>
    
    <% (1..@total_pages).each do |page| %>
      <% if page == @current_page %>
        <span class="current"><%= page %></span>
      <% else %>
        <%= link_to page, category_path(@category.slug, params.permit!.merge(page: page)) %>
      <% end %>
    <% end %>
    
    <% if @current_page < @total_pages %>
      <%= link_to "Next", category_path(@category.slug, params.permit!.merge(page: @current_page + 1)) %>
    <% end %>
  </div>
<% end %>

<!-- No products message -->
<% if @products.empty? %>
  <div style="text-align: center; margin: 50px 0;">
    <h3>No products found in <%= @category.name %></h3>
    <p>Try adjusting your search or filter criteria.</p>
    <%= link_to "Browse All Categories", categories_path, style: "color: #3498db;" %>
  </div>
<% end %>

<style>
  .subcategory-card:hover {
    transform: translateY(-2px);
  }
</style>