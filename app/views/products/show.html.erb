<!-- app/views/products/show.html.erb -->

<!-- Breadcrumb Navigation -->
<div class="breadcrumb" style="margin-bottom: 20px; padding: 10px 0; color: #7f8c8d; font-size: 14px;">
  <%= link_to "All Products", products_path, style: "color: #3498db; text-decoration: none;" %>
  <% if @product.categories.any? %>
    <% primary_category = @product.categories.first %>
    > <%= link_to primary_category.name, category_path(primary_category.slug), style: "color: #3498db; text-decoration: none;" %>
  <% end %>
  > <span style="color: #2c3e50; font-weight: bold;"><%= @product.name %></span>
</div>

<!-- Product Detail Container -->
<div class="product-detail" style="background-color: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); padding: 30px; margin-bottom: 30px;">
  
  <!-- Product Header -->
  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 40px; margin-bottom: 30px;">
    
    <!-- Product Images -->
    <div class="product-images">
      <% if @product.images.attached? %>
        <div class="main-image" style="margin-bottom: 15px;">
          <%= image_tag @product.primary_image, alt: @product.name, 
                        style: "width: 100%; height: 400px; object-fit: cover; border-radius: 8px; border: 1px solid #ddd;" %>
        </div>
        
        <% if @product.images.count > 1 %>
          <div class="image-thumbnails" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(80px, 1fr)); gap: 10px;">
            <% @product.images.each_with_index do |image, index| %>
              <%= image_tag image, alt: "#{@product.name} - Image #{index + 1}", 
                            style: "width: 100%; height: 80px; object-fit: cover; border-radius: 4px; border: 1px solid #ddd; cursor: pointer;",
                            onclick: "changeMainImage(this.src)" %>
            <% end %>
          </div>
        <% end %>
      <% else %>
        <div style="width: 100%; height: 400px; background-color: #f0f0f0; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #7f8c8d; font-size: 18px;">
          No Image Available
        </div>
      <% end %>
    </div>
    
    <!-- Product Info -->
    <div class="product-info">
      <h1 style="color: #2c3e50; margin-bottom: 10px; font-size: 28px;"><%= @product.name %></h1>
      
      <!-- SKU -->
      <div style="color: #7f8c8d; margin-bottom: 15px; font-size: 14px;">
        <strong>SKU:</strong> <%= @product.sku %>
      </div>
      
      <!-- Categories -->
      <% if @product.categories.any? %>
        <div class="product-categories" style="margin-bottom: 20px;">
          <% @product.categories.each do |category| %>
            <%= link_to category.full_name, category_path(category.slug), 
                        style: "display: inline-block; background-color: #ecf0f1; color: #2c3e50; padding: 5px 10px; margin-right: 5px; margin-bottom: 5px; border-radius: 15px; text-decoration: none; font-size: 12px;" %>
          <% end %>
        </div>
      <% end %>
      
      <!-- Price -->
      <div class="product-pricing" style="margin-bottom: 25px;">
        <% if @product.on_sale? %>
          <div class="sale-price" style="font-size: 32px; color: #27ae60; font-weight: bold;">
            <%= number_to_currency(@product.sale_price) %>
          </div>
          <div class="original-price" style="font-size: 20px; color: #95a5a6; text-decoration: line-through;">
            <%= number_to_currency(@product.price) %>
          </div>
          <div class="savings" style="background-color: #e74c3c; color: white; display: inline-block; padding: 5px 10px; border-radius: 4px; font-size: 14px; margin-top: 5px;">
            Save <%= number_to_currency(@product.price - @product.sale_price) %>!
          </div>
        <% else %>
          <div class="regular-price" style="font-size: 32px; color: #2c3e50; font-weight: bold;">
            <%= number_to_currency(@product.price) %>
          </div>
        <% end %>
      </div>
      
      <!-- Stock Status -->
      <div class="stock-status" style="margin-bottom: 25px;">
        <% if @product.in_stock? %>
          <div style="color: #27ae60; font-size: 16px; font-weight: bold;">
            ✓ In Stock (<%= @product.stock_quantity %> available)
          </div>
        <% else %>
          <div style="color: #e74c3c; font-size: 16px; font-weight: bold;">
            ✗ Out of Stock
          </div>
        <% end %>
      </div>
      
      <!-- Product Features (if weight/dimensions available) -->
      <% if @product.weight.present? || @product.dimensions.present? %>
        <div class="product-features" style="background-color: #f8f9fa; padding: 15px; border-radius: 6px; margin-bottom: 25px;">
          <h4 style="color: #2c3e50; margin-bottom: 10px;">Specifications</h4>
          <% if @product.weight.present? %>
            <div style="margin-bottom: 5px;"><strong>Weight:</strong> <%= @product.weight %> lbs</div>
          <% end %>
          <% if @product.dimensions.present? %>
            <div><strong>Dimensions:</strong> <%= @product.dimensions %></div>
          <% end %>
        </div>
      <% end %>
      
      <!-- Add to Cart Button (placeholder) -->
      <div class="add-to-cart" style="margin-bottom: 20px;">
        <% if @product.in_stock? %>
          <button style="background-color: #3498db; color: white; padding: 15px 30px; border: none; border-radius: 6px; font-size: 18px; cursor: pointer; width: 100%; margin-bottom: 10px;" onclick="alert('Shopping cart functionality coming in Section 3!')">
            Add to Cart - <%= number_to_currency(@product.display_price) %>
          </button>
        <% else %>
          <button style="background-color: #95a5a6; color: white; padding: 15px 30px; border: none; border-radius: 6px; font-size: 18px; width: 100%; margin-bottom: 10px;" disabled>
            Out of Stock
          </button>
        <% end %>
        
        <div style="text-align: center;">
          <%= link_to "← Back to Products", products_path, style: "color: #3498db; text-decoration: none;" %>
        </div>
      </div>
      
      <!-- Featured Badge -->
      <% if @product.featured? %>
        <div style="background-color: #f39c12; color: white; padding: 8px 12px; border-radius: 4px; display: inline-block; font-size: 14px; font-weight: bold;">
          ⭐ Featured Product
        </div>
      <% end %>
    </div>
  </div>
  
  <!-- Product Description -->
  <div class="product-description" style="border-top: 1px solid #ecf0f1; padding-top: 30px; margin-bottom: 30px;">
    <h3 style="color: #2c3e50; margin-bottom: 15px;">Product Description</h3>
    <div style="color: #2c3e50; line-height: 1.8; font-size: 16px;">
      <%= simple_format(@product.description) %>
    </div>
  </div>
</div>

<!-- Related Products -->
<% if @related_products.any? %>
  <div class="related-products" style="margin-bottom: 30px;">
    <h3 style="color: #2c3e50; text-align: center; margin-bottom: 25px;">You Might Also Like</h3>
    
    <div class="products-grid" style="grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));">
      <% @related_products.each do |product| %>
        <div class="product-card">
          <%= link_to product_path(product), style: "text-decoration: none; color: inherit;" do %>
            <% if product.primary_image.present? %>
              <%= image_tag product.primary_image, alt: product.name, class: "product-image" %>
            <% else %>
              <div class="product-image" style="display: flex; align-items: center; justify-content: center; color: #7f8c8d;">
                No Image
              </div>
            <% end %>
            
            <div class="product-info">
              <div class="product-categories">
                <%= product.category_names %>
              </div>
              
              <div class="product-name">
                <%= product.name %>
              </div>
              
              <div class="product-price <%= 'on-sale' if product.on_sale? %>">
                <% if product.on_sale? %>
                  <%= number_to_currency(product.sale_price) %>
                  <span class="original-price"><%= number_to_currency(product.price) %></span>
                <% else %>
                  <%= number_to_currency(product.price) %>
                <% end %>
              </div>
              
              <div class="product-stock <%= product.in_stock? ? 'in-stock' : 'out-of-stock' %>">
                <%= product.in_stock? ? "In Stock" : "Out of Stock" %>
              </div>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>
<% end %>

<!-- JavaScript for image switching -->
<script>
  function changeMainImage(src) {
    document.querySelector('.main-image img').src = src;
  }
</script>

<!-- Responsive Styles -->
<style>
  @media (max-width: 768px) {
    .product-detail > div:first-child {
      grid-template-columns: 1fr !important;
      gap: 20px !important;
    }
    
    .product-detail h1 {
      font-size: 24px !important;
    }
    
    .product-pricing .sale-price,
    .product-pricing .regular-price {
      font-size: 28px !important;
    }
  }
</style>