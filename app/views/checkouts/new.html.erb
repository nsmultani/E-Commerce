<!-- app/views/checkouts/new.html.erb -->

<div class="checkout-container" style="max-width: 1000px; margin: 0 auto;">
  <h1 style="text-align: center; color: #2c3e50; margin-bottom: 30px;">Checkout</h1>

  <div style="display: grid; grid-template-columns: 1fr 400px; gap: 40px;">
    
    <!-- Checkout Form -->
    <div class="checkout-form" style="background-color: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
      <h2 style="color: #2c3e50; margin-bottom: 20px;">Billing Information</h2>
      
      <%= form_with model: @checkout, url: checkout_path, local: true do |f| %>
        <% if @checkout.errors.any? %>
          <div style="background-color: #f8d7da; color: #721c24; padding: 15px; border-radius: 6px; margin-bottom: 20px;">
            <h4>Please correct the following errors:</h4>
            <ul>
              <% @checkout.errors.full_messages.each do |message| %>
                <li><%= message %></li>
              <% end %>
            </ul>
          </div>
        <% end %>

        <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
          <div>
            <%= f.label :customer_name, "Full Name", style: "display: block; margin-bottom: 5px; font-weight: bold;" %>
            <%= f.text_field :customer_name, style: "width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;" %>
          </div>
          <div>
            <%= f.label :email, "Email Address", style: "display: block; margin-bottom: 5px; font-weight: bold;" %>
            <%= f.email_field :email, style: "width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;" %>
          </div>
        </div>

        <div class="form-group" style="margin-bottom: 20px;">
          <%= f.label :address_line_1, "Street Address", style: "display: block; margin-bottom: 5px; font-weight: bold;" %>
          <%= f.text_field :address_line_1, style: "width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;" %>
        </div>

        <div class="form-group" style="margin-bottom: 20px;">
          <%= f.label :address_line_2, "Apartment, suite, etc. (optional)", style: "display: block; margin-bottom: 5px; font-weight: bold;" %>
          <%= f.text_field :address_line_2, style: "width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;" %>
        </div>

        <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-bottom: 20px;">
          <div>
            <%= f.label :city, "City", style: "display: block; margin-bottom: 5px; font-weight: bold;" %>
            <%= f.text_field :city, style: "width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;" %>
          </div>
          <div>
            <%= f.label :province_id, "Province", style: "display: block; margin-bottom: 5px; font-weight: bold;" %>
            <%= f.select :province_id, 
                         options_from_collection_for_select(@provinces, :id, :display_name_with_tax, @checkout.province_id),
                         { prompt: "Select Province" },
                         { style: "width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;",
                           onchange: "updateTaxes(this.value)" } %>
          </div>
          <div>
            <%= f.label :postal_code, "Postal Code", style: "display: block; margin-bottom: 5px; font-weight: bold;" %>
            <%= f.text_field :postal_code, placeholder: "A1A 1A1", style: "width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;" %>
          </div>
        </div>

        <div class="form-group" style="margin-bottom: 30px;">
          <%= f.label :country, "Country", style: "display: block; margin-bottom: 5px; font-weight: bold;" %>
          <%= f.text_field :country, value: "Canada", readonly: true, style: "width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; background-color: #f8f9fa;" %>
        </div>

        <div style="text-align: center;">
          <%= f.submit "Place Order", style: "background-color: #27ae60; color: white; padding: 15px 40px; border: none; border-radius: 6px; font-size: 18px; cursor: pointer;" %>
        </div>
      <% end %>
    </div>

    <!-- Order Summary -->
    <div class="order-summary" style="background-color: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); height: fit-content;">
      <h2 style="color: #2c3e50; margin-bottom: 20px;">Order Summary</h2>

      <!-- Cart Items -->
      <div class="summary-items">
        <% @cart_items.each do |item| %>
          <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #ecf0f1;">
            <div>
              <div style="font-weight: bold; color: #2c3e50;"><%= item[:product].name %></div>
              <div style="color: #7f8c8d; font-size: 14px;">Qty: <%= item[:quantity] %> × <%= number_to_currency(item[:product].display_price) %></div>
            </div>
            <div style="font-weight: bold; color: #2c3e50;">
              <%= number_to_currency(item[:total_price]) %>
            </div>
          </div>
        <% end %>
      </div>

      <!-- Totals -->
      <div class="summary-totals" style="margin-top: 20px;">
        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
          <span>Subtotal:</span>
          <span id="subtotal-amount"><%= number_to_currency(@subtotal) %></span>
        </div>
        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
          <span>Taxes:</span>
          <span id="tax-amount"><%= number_to_currency(@tax_amount || 0) %></span>
        </div>
        <hr style="border: none; border-top: 2px solid #3498db; margin: 15px 0;">
        <div style="display: flex; justify-content: space-between; font-size: 18px; font-weight: bold; color: #2c3e50;">
          <span>Total:</span>
          <span id="total-amount"><%= number_to_currency(@total || @subtotal) %></span>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
function updateTaxes(provinceId) {
  if (!provinceId) return;
  
  // This would typically be an AJAX call to update taxes
  // For now, we'll submit the form to recalculate
  // In a production app, you'd want to use AJAX here
  console.log('Province selected:', provinceId);
}
</script>

<!-- app/views/checkouts/success.html.erb -->

<div style="max-width: 600px; margin: 0 auto; text-align: center; padding: 50px 20px;">
  <div style="background-color: white; padding: 50px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
    <div style="color: #27ae60; font-size: 72px; margin-bottom: 20px;">✓</div>
    
    <h1 style="color: #2c3e50; margin-bottom: 20px;">Order Confirmed!</h1>
    
    <p style="color: #7f8c8d; font-size: 18px; margin-bottom: 30px;">
      Thank you for your order. Your order number is <strong>#<%= @order.id %></strong>
    </p>
    
    <div style="background-color: #f8f9fa; padding: 20px; border-radius: 6px; margin-bottom: 30px; text-align: left;">
      <h3 style="color: #2c3e50; margin-bottom: 15px;">Order Details</h3>
      <p><strong>Customer:</strong> <%= @order.customer_name %></p>
      <p><strong>Email:</strong> <%= @order.email %></p>
      <p><strong>Total:</strong> <%= number_to_currency(@order.total) %></p>
      <p><strong>Status:</strong> <span style="color: #f39c12; text-transform: capitalize;"><%= @order.status %></span></p>
    </div>
    
    <div>
      <%= link_to "Continue Shopping", products_path, 
                  style: "background-color: #3498db; color: white; padding: 12px 30px; text-decoration: none; border-radius: 6px; margin-right: 10px;" %>
    </div>
  </div>
</div>