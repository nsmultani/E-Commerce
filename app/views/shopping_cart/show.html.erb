<!-- app/views/shopping_cart/show.html.erb - Enhanced quantity editing: -->

<div class="shopping-cart" style="background-color: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
  
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; border-bottom: 2px solid #3498db; padding-bottom: 15px;">
    <h1 style="color: #2c3e50; margin: 0;">Shopping Cart</h1>
    <% unless current_cart.empty? %>
      <%= link_to "Clear Cart", cart_clear_path, method: :delete, 
                  confirm: "Are you sure you want to clear your cart?",
                  style: "color: #e74c3c; text-decoration: none; font-size: 14px;" %>
    <% end %>
  </div>

  <% if current_cart.empty? %>
    <div style="text-align: center; margin: 50px 0;">
      <div style="font-size: 48px; color: #bdc3c7; margin-bottom: 20px;">ðŸ›’</div>
      <h3 style="color: #7f8c8d;">Your cart is empty</h3>
      <p style="color: #95a5a6; margin-bottom: 30px;">Add some products to get started!</p>
      <%= link_to "Continue Shopping", products_path, 
                  style: "background-color: #3498db; color: white; padding: 12px 25px; text-decoration: none; border-radius: 6px; display: inline-block;" %>
    </div>
  <% else %>
    
    <!-- Cart Items -->
    <div class="cart-items">
      <% current_cart.products.each do |cart_item| %>
        <% product = cart_item[:product] %>
        <% quantity = cart_item[:quantity] %>
        <% item_total = cart_item[:total_price] %>
        
        <div class="cart-item" style="display: grid; grid-template-columns: 100px 1fr auto auto auto; gap: 20px; align-items: center; padding: 20px 0; border-bottom: 1px solid #ecf0f1;">
          
          <!-- Product Image -->
          <div>
            <%= link_to product_path(product) do %>
              <% if product.primary_image.present? %>
                <%= image_tag product.primary_image, alt: product.name, 
                            style: "width: 80px; height: 80px; object-fit: cover; border-radius: 6px; border: 1px solid #ddd;" %>
              <% else %>
                <div style="width: 80px; height: 80px; background-color: #f0f0f0; border-radius: 6px; display: flex; align-items: center; justify-content: center; color: #7f8c8d; font-size: 12px;">
                  No Image
                </div>
              <% end %>
            <% end %>
          </div>
          
          <!-- Product Info -->
          <div>
            <h4 style="margin: 0 0 5px 0; color: #2c3e50;">
              <%= link_to product.name, product_path(product), style: "color: inherit; text-decoration: none;" %>
            </h4>
            <div style="color: #7f8c8d; font-size: 14px; margin-bottom: 5px;">
              SKU: <%= product.sku %>
            </div>
            <div style="color: #7f8c8d; font-size: 14px; margin-bottom: 5px;">
              Unit Price: <%= number_to_currency(product.display_price) %>
            </div>
            <div style="color: #7f8c8d; font-size: 12px;">
              <%= truncate(product.description, length: 80) %>
            </div>
          </div>
          
          <!-- app/views/shopping_cart/show.html.erb - Fix all form paths: -->

<!-- Quantity Controls - Updated paths -->
<div style="text-align: center;">
  <div style="margin-bottom: 10px; font-weight: bold; color: #2c3e50;">Quantity</div>
  
  <!-- Quantity controls with up/down buttons -->
  <div style="display: flex; align-items: center; justify-content: center; gap: 5px; margin-bottom: 10px;">
    <!-- Decrease button -->
    <%= form_with url: cart_update_path(product_id: product.id), method: :patch, local: true, style: "display: inline;" do |f| %>
      <%= f.hidden_field :quantity, value: [quantity - 1, 1].max %>
      <%= f.submit "-", style: "width: 30px; height: 30px; background-color: #e74c3c; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px;" %>
    <% end %>
    
    <!-- Quantity display -->
    <span style="padding: 5px 10px; border: 1px solid #ddd; border-radius: 4px; min-width: 40px; text-align: center; background-color: #f8f9fa;">
      <%= quantity %>
    </span>
    
    <!-- Increase button -->
    <%= form_with url: cart_update_path(product_id: product.id), method: :patch, local: true, style: "display: inline;" do |f| %>
      <%= f.hidden_field :quantity, value: [quantity + 1, product.stock_quantity].min %>
      <%= f.submit "+", style: "width: 30px; height: 30px; background-color: #27ae60; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px;" %>
    <% end %>
  </div>
  
  <!-- Manual quantity update form -->
  <div style="margin-top: 10px;">
    <%= form_with url: cart_update_path(product_id: product.id), method: :patch, local: true, style: "display: flex; align-items: center; gap: 5px; justify-content: center;" do |f| %>
      <%= f.number_field :quantity, value: quantity, min: 1, max: product.stock_quantity,
                        style: "width: 60px; padding: 5px; border: 1px solid #ddd; border-radius: 4px; text-align: center;" %>
      <%= f.submit "Update", style: "padding: 5px 10px; background-color: #95a5a6; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;" %>
    <% end %>
  </div>
  
  <div style="font-size: 12px; color: #7f8c8d; margin-top: 5px;">
    Available: <%= product.stock_quantity %>
  </div>
</div>

<!-- Item Total -->
<div style="text-align: center;">
  <div style="font-weight: bold; color: #2c3e50; font-size: 16px;">
    <%= number_to_currency(item_total) %>
  </div>
  <div style="font-size: 12px; color: #7f8c8d;">
    (<%= quantity %> Ã— <%= number_to_currency(product.display_price) %>)
  </div>
</div>

<!-- Remove Button - Independent of quantity editing -->
<div style="text-align: center;">
  <%= button_to "Remove", cart_remove_path(product_id: product.id), 
              method: :delete, 
              form: { data: { turbo_confirm: "Remove #{product.name} from cart?" } },
              style: "background-color: #e74c3c; color: white; padding: 8px 12px; border: none; border-radius: 4px; font-size: 14px; display: inline-block; cursor: pointer;"
              %>
</div>
        </div>
      <% end %>
    </div>
    
    <!-- Cart Summary -->
    <div class="cart-summary" style="margin-top: 30px; padding: 20px; background-color: #f8f9fa; border-radius: 6px;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h3 style="color: #2c3e50; margin: 0;">Cart Summary</h3>
        <div style="color: #7f8c8d; font-size: 14px;">
          <%= pluralize(current_cart.total_items, 'item') %>
        </div>
      </div>
      
      <!-- Itemized breakdown -->
      <div style="margin-bottom: 15px;">
        <% current_cart.products.each do |cart_item| %>
          <div style="display: flex; justify-content: space-between; margin-bottom: 5px; font-size: 14px;">
            <span style="color: #7f8c8d;"><%= cart_item[:product].name %> (Ã— <%= cart_item[:quantity] %>)</span>
            <span style="color: #2c3e50;"><%= number_to_currency(cart_item[:total_price]) %></span>
          </div>
        <% end %>
      </div>
      
      <hr style="border: none; border-top: 1px solid #ddd; margin: 15px 0;">
      
      <div style="display: flex; justify-content: space-between; align-items: center; font-size: 18px; font-weight: bold; color: #2c3e50;">
        <span>Subtotal:</span>
        <span><%= number_to_currency(current_cart.subtotal) %></span>
      </div>
      
      <div style="margin-top: 20px; text-align: center;">
        <%= link_to "Proceed to Checkout", checkout_path, 
                    style: "background-color: #27ae60; color: white; padding: 15px 40px; text-decoration: none; border-radius: 6px; font-size: 18px; display: inline-block; margin-right: 10px;" %>
        <%= link_to "Continue Shopping", products_path, 
                    style: "color: #3498db; text-decoration: none; padding: 15px 20px;" %>
      </div>
    </div>
  <% end %>
</div>